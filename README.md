# Form 101 ETL - Оборотная ведомость по счетам бухгалтерского учета

ETL-решение для автоматизации формирования регламентной отчетности по форме 101 ЦБ РФ. Аналитическая витрина данных агрегирует и преобразует данные из операционной базы данных в соответствии с требованиями Центрального Банка Российской Федерации.

## Назначение

Проект предназначен для автоматизации процесса подготовки оборотной ведомости по счетам бухгалтерского учета кредитной организации (Форма 101 — «Оборотная ведомость по счетам бухгалтерского учёта кредитной организации»,). Решение рассчитывает:

- Входящие остатки на начало периода
- Обороты по дебету и кредиту за период
- Исходящие остатки на конец периода

## Источники данных

### Основные таблицы

- **`bank.restdate_dbt`** - остатки на счетах
- **`bank.account_dbt`** - справочник счетов бухгалтерского учета
- **`bank.arhdoc_dbt`** - архив проводок (обороты)

### Ключевые поля

- `account` - номер счета
- `balance` - номер балансового счета
- `chapter` - раздел плана счетов (1-4)
- `kind_Account` - вид счета (А - активный, П - пассивный)
- `date_carry` - дата проводки
- `rest` - остаток
- `sum` - сумма операции

##  Логика работы

### Основные этапы обработной ведомости

1. **Определение активных счетов** на отчетный период
2. **Расчет входящих остатков** на начало периода
3. **Агрегация оборотов** за период по дебету и кредиту
4. **Расчет исходящих остатков** на конец периода
5. **Формирование итогового отчета**

### Классификация счетов

- **Рублевые счета**: `account LIKE '_____810%'` (VR/IR)
- **Валютные счета**: `account NOT LIKE '_____810%'` (VC/IC)
- **Специальные счета**: 
  - `account LIKE '_____098%'` (VG/IG)
  - `account LIKE '_____099%'` (VM/IM)
  - `account LIKE '_____076%'` (VM/IM)
  - `account LIKE '_____033%'` (VM/IM)

##  Использование

### Быстрый старт

```sql
-- Для использования с другим периодом замените даты:
WHERE date_carry < '2021-05-01'    -- Начало периода
WHERE date_carry < '2021-06-01'    -- Конец периода  
BETWEEN '2021-05-01' and '2021-05-31'  -- Период оборотов

Структура выходных данных
PLAN - Раздел плана счетов
NUM_SC - Номер балансового счета
A_P -	Вид счета (а/п)
DT - Дата отчетности
VR, VC, VG, VM, VITG - Входящие остатки
ORA, OCA, OGA, OMA, OITGA -	Обороты по дебету
ORP, OCP, OGP, OMP, OITGP -	Обороты по кредиту
IR, IC, IG, IM, IITG -	Исходящие остатки

 Требования
Доступ к операционной БД банка

Таблицы restdate_dbt, account_dbt, arhdoc_dbt

Права на чтение данных

SQL-клиент для выполнения запросов

  Особенности реализации
Фильтрация только активных счетов на отчетную дату

Учет только валютных операций (Code_Currency = 0)

Исключение внутренних проводок (Real_Payer != Real_Receiver)

Агрегация данных по балансовым счетам

Конвертация сумм в тысячи рублей

 Технические детали
Основные CTE блоки
sql
last_dates_incoming    -- последние даты остатков на начало периода  
last_dates_outgoing    -- последние даты остатков на конец периода
filtered_accounts      -- активные счета с оборотами/остатками
incoming_balances      -- входящие остатки
turnovers             -- обороты за период
outgoing_balances     -- исходящие остатки

  Решение разработано для автоматизации процессов формирования регламентной отчетности кредитной организации.
